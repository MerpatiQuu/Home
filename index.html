<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir MerpatiQuu</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css" rel="stylesheet">
    <!-- Font Awesome CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
/* Logo and Header Title */
.logo-container {
    text-align: center;
    margin: 0;
    padding: 0;
}

.logo-container img {
    max-width: 60px; /* Menyesuaikan ukuran logo pada perangkat kecil */
    height: auto;
    background: none;
}

.header-title {
    text-align: center;
    margin-bottom: 0;
    font-size: 1.5rem; /* Menyesuaikan ukuran font pada perangkat kecil */
    background: linear-gradient(to right, blue, rgb(255, 251, 0));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
    font-weight: bold;
}

/* Buttons */
.btn-custom {
    padding: 1px 1px; /* Menambah padding untuk tombol agar lebih mudah di klik pada perangkat kecil */
    font-size: 10px; /* Menyesuaikan ukuran font tombol */
}

.btn-no-bg {
    background: none;
    border: none;
    padding: 0;
    margin: 0;
}

.plus-icon {
    color: blue;
    font-size: 1rem; /* Menyesuaikan ukuran icon pada perangkat kecil */
}

.ml-1 {
    margin-left: 5px;
}

.btn-no-bg:hover .plus-icon {
    color: darkblue;
}

.btn-print {
    font-size: 0.575rem;
    padding: 0rem;
    border: 1px solid #007bff;
    color: #007bff;
    background-color: transparent;
}

.btn-print:hover {
    background-color: #007bff;
    color: #fff;
}
/* Style for the button with no background */
.btn-no-bg {
    background: transparent; /* Remove background color */
    border: none; /* Remove border */
    padding: 0; /* Remove padding */
    margin: 0; /* Remove margin */
    font-size: 1rem; /* Adjust font size as needed */
    cursor: pointer; /* Change cursor to pointer to indicate it's clickable */
}

/* Optional: Style the button icon */
.btn-no-bg .fa-trash {
    color: #dc3545; /* Font Awesome color for danger (red) */
    font-size: 1.25rem; /* Adjust icon size if needed */
}

/* Optional: Add a hover effect if desired */
.btn-no-bg:hover {
    opacity: 0.8; /* Slightly fade the button on hover */
}

/* Tables */
.table {
    font-size: 0.875rem; /* Menyesuaikan ukuran font tabel */
}
/* Ensure the table has no padding or margin */
#transactionTable {
    width: 100%; /* Make sure table takes up full width */
    border-collapse: collapse; /* Remove spacing between borders */
    border: none; /* Remove any default border */
}

/* Remove padding and margin from table cells and rows */
#transactionTable th, #transactionTable td {
    padding: 0; /* Remove padding */
    margin: 0;  /* Remove margin */
    border: none; /* Remove borders */
    text-align: left; /* Align text to the left */
}

/* Remove padding and margin from table headers */
#transactionTable thead th {
    padding: 0; /* Remove padding */
    margin: 0;  /* Remove margin */
    border-bottom: none; /* Remove bottom border from headers if needed */
}

/* Remove any extra spacing around the table */
#transactionTable_wrapper {
    margin: 0; /* Remove wrapper margin */
    padding: 0; /* Remove wrapper padding */
}

/* Ensure headers have a consistent appearance */
#transactionTable thead th {
    font-weight: bold; /* Optional: make headers bold */
}

.total {
    margin-top: 20px;
    font-weight: bold;
}

.total-section {
    display: flex;
    flex-direction: column; /* Menyesuaikan agar total section tampil vertikal pada perangkat kecil */
    align-items: stretch; /* Menyesuaikan agar form-group mengisi lebar penuh */
    margin-top: 1px;
}

.total-section .form-group {
    margin-bottom: 1px;
}

.payment-input, .change-display {
    margin-left: 0; /* Menghilangkan margin-left pada perangkat kecil */
    margin-bottom: 1px; /* Menambahkan margin-bottom untuk jarak antar elemen */
}

.payment-input input, .change-display input {
    width: 100%; /* Menyesuaikan lebar input agar penuh pada perangkat kecil */
    padding: 5px;
    font-size: 10px;
}

/* Form Controls */
.form-control {
    font-size: 10px; /* Menyesuaikan ukuran font formulir */
    padding: 5px; /* Menambah padding untuk kenyamanan */
}

label {
    font-weight: bold;
}
/* Base styles for the modal */
.modal-sm {
    max-width: 100%; /* Full width on small devices */
    margin: 0; /* Remove margin to utilize full screen width on mobile */
}

/* Modal content styling */
.modal-sm .modal-content {
    font-size: 0.75rem; /* Adjust font size in modal */
}

/* Input and button styling */
.modal-sm .form-control, 
.modal-sm .btn {
    font-size: 0.75rem; /* Adjust font size for input and buttons */
    padding: 0.5rem;
}

/* Styles for mobile devices */
@media (max-width: 767px) {
    .modal-sm {
        max-width: 90%; /* Reduce max width on small screens to avoid overflow */
        margin: 0 auto; /* Center the modal horizontally */
    }
}

/* Styles for larger devices (desktops) */
@media (min-width: 768px) {
    .modal-sm {
        max-width: 800px; /* Set a maximum width for larger screens */
        margin: 1.5rem auto; /* Center the modal and add vertical margin */
    }
    
    .modal-sm .modal-content {
        font-size: 0.875rem; /* Slightly larger font size for better readability on larger screens */
    }
    
    .modal-sm .form-control, 
    .modal-sm .btn {
        font-size: 0.875rem; /* Slightly larger font size for inputs and buttons */
        padding: 0.75rem; /* Increase padding for better spacing */
    }
}

/* Additional adjustments for modal body layout */
@media (min-width: 768px) {
    .modal-sm .modal-body {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* Create two columns */
        gap: 1rem; /* Space between items */
    }

    .modal-sm .modal-body .form-group {
        margin-bottom: 1rem; /* Space between form groups */
    }
    
    .modal-sm .form-row {
        display: contents; /* Let grid layout handle the row arrangement */
    }

    .modal-sm .form-row .form-group {
        margin: 0; /* Remove default margins */
    }
}

/* Ensure button styling remains consistent */
.modal-sm .btn-no-bg {
    background: none; /* Remove background */
    border: none; /* Remove border */
    cursor: pointer; /* Show pointer cursor on hover */
}

/* Ensure icon is centered and styled */
.modal-sm .plus-icon {
    font-size: 1rem; /* Adjust icon size */
}

/* Print Styles */
@media print {
    @page {
        size: 58mm auto;
        margin: 0;
    }
    
    body * {
        visibility: hidden;
    }
    
    #transactionTable, #transactionTable * {
        visibility: visible;
    }
    
    .print-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 58mm;
        text-align: center;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .print-header img {
        width: 50px;
        height: auto;
    }
    
    #transactionTable {
        position: absolute;
        left: 0;
        top: 60px;
        width: 58mm;
        font-size: 12px;
        line-height: 1.2;
    }
    
    #transactionTable th, #transactionTable td {
        padding: 5px;
        border: 1px solid #000;
    }
    
    #grandTotalDisplay {
        font-size: 12px;
        text-align: right;
        margin-top: 10px;
    }
    
    .btn-print {
        display: none;
    }
    
    #transactionTable th:nth-child(6), #transactionTable td:nth-child(6) {
        display: none;
    }
}

/* General Styles */
.print-header {
    display: none;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.6em;
}

td, th {
    border: none;
    padding: 0;
    margin: 0;
    font-size: inherit;
}

.tableitem {
    padding: 0;
    margin: 0;
}

.hide-column {
    display: none;
}

.combined-content {
    margin: 0;
    padding: 0;
}

.btn {
    padding: 2px 4px;
    font-size: 0.8em;
}

/* Media Queries for Mobile */
@media (max-width: 768px) {
    .row {
        flex-direction: column; /* Menyusun kolom secara vertikal pada perangkat kecil */
    }

    .col-md-6 {
        width: 100%; /* Menyusun kolom secara penuh pada perangkat kecil */
    }

    .total-section {
        flex-direction: column; /* Mengatur flex direction ke column untuk total-section */
    }

    .btn-custom, .btn-print {
        font-size: 14px; /* Menyesuaikan ukuran font untuk tombol pada perangkat kecil */
        padding: 8px 12px; /* Menambah padding tombol agar lebih mudah di klik */
    }

    .logo-container img {
        max-width: 50px; /* Menyesuaikan ukuran logo pada perangkat kecil */
    }

    .header-title {
        font-size: 1.2rem; /* Menyesuaikan ukuran font judul pada perangkat kecil */
    }
}

@media (max-width: 576px) {
    .header-title {
        font-size: 1rem; /* Menyesuaikan ukuran font judul pada perangkat sangat kecil */
    }
}
        /* Cool infinite background scrolling animation.
 * Twitter: @kootoopas
 */
/* Exo thin font from Google. */
@import url('https://fonts.googleapis.com/css?family=Exo:100');
/* Background data (Original source: https://subtlepatterns.com/grid-me/) */
/* Animations */
@-webkit-keyframes bg-scrolling-reverse {
  100% {
    background-position: 50px 50px;
  }
}
@-moz-keyframes bg-scrolling-reverse {
  100% {
    background-position: 50px 50px;
  }
}
@-o-keyframes bg-scrolling-reverse {
  100% {
    background-position: 50px 50px;
  }
}
@keyframes bg-scrolling-reverse {
  100% {
    background-position: 50px 50px;
  }
}
@-webkit-keyframes bg-scrolling {
  0% {
    background-position: 50px 50px;
  }
}
@-moz-keyframes bg-scrolling {
  0% {
    background-position: 50px 50px;
  }
}
@-o-keyframes bg-scrolling {
  0% {
    background-position: 50px 50px;
  }
}
@keyframes bg-scrolling {
  0% {
    background-position: 50px 50px;
  }
}
/* Main styles */
body {
  margin-top: 1rem;
  /* img size is 50x50 */
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAABnSURBVHja7M5RDYAwDEXRDgmvEocnlrQS2SwUFST9uEfBGWs9c97nbGtDcquqiKhOImLs/UpuzVzWEi1atGjRokWLFi1atGjRokWLFi1atGjRokWLFi1af7Ukz8xWp8z8AAAA//8DAJ4LoEAAlL1nAAAAAElFTkSuQmCC") repeat 0 0;
  -webkit-animation: bg-scrolling-reverse 0.92s infinite;
  /* Safari 4+ */
  -moz-animation: bg-scrolling-reverse 0.92s infinite;
  /* Fx 5+ */
  -o-animation: bg-scrolling-reverse 0.92s infinite;
  /* Opera 12+ */
  animation: bg-scrolling-reverse 0.92s infinite;
  /* IE 10+ */
  -webkit-animation-timing-function: linear;
  -moz-animation-timing-function: linear;
  -o-animation-timing-function: linear;
  animation-timing-function: linear;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Section -->
        <div class="logo-container">
            <img src="https://github.com/MerpatiQuu/MTsAU/blob/main/WhatsApp%20Image%202024-09-11%20at%2014.38.17.jpeg?raw=true" alt="Logo">
        </div>
        
        <!-- Main Title -->
        <h1 class="header-title">MerpatiQuu</h1>
<!-- Modal Structure -->
<div class="modal fade modal-sm" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="itemModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="itemModalLabel">Tambah Pembelian</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="item">Nama Barang:</label>
                        <input type="text" id="item" class="form-control" placeholder="-" readonly>
                    </div>
                    <div class="form-group">
                        <label for="quantity">Jumlah:</label>
                        <input type="number" id="quantity" class="form-control" placeholder="Masukkan jumlah" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="priceType">Jenis:</label>
                        <select id="priceType" class="form-control" onchange="updatePrice()">
                            <option value="pcs">Pcs</option>
                            <option value="pac">Pac</option>
                            <option value="dos">Dos</option>
                            <option value="mm" selected>MM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="isi">Isi:</label>
                        <input type="number" id="isi" class="form-control" placeholder="-" min="0">
                    </div>
                    <div class="form-group">
                        <label for="price">Harga:</label>
                        <input type="number" id="price" class="form-control" placeholder="-" min="0">
                    </div>
                    <div class="form-group">
                        <label for="total">Total:</label>
                        <input type="number" id="total" class="form-control" placeholder="-" min="0" readonly>
                    </div>
                    <div class="form-group d-flex justify-content-center align-items-center">
                        <button onclick="addTransaction()" class="btn-no-bg">
                            <i class="fas fa-plus plus-icon"></i> <!-- Font Awesome Plus Icon -->
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container mt-4">
    <div class="row">
        <!-- Kotak di sebelah kiri -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h2>Daftar Transaksi</h2>
                    <table id="transactionTable" class="table table-bordered">
                        <thead class="d-none">
                            <tr>
                                <th>No</th>
                                <th>Nama Barang</th>
                                <th>Jumlah</th>
                                <th>Jenis</th>
                                <th class="d-none">Harga (Rp)</th>
                                <th>Harga (Rp)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <div class="total-section">
                        <!-- Total Keseluruhan -->
                        <div class="form-group">
                            <label for="updateGrandTotal">Total:</label>
                            <input type="text" id="updateGrandTotal" class="form-control" readonly value="Rp 0">
                        </div>
                        <!-- Input field for Bayar -->
                        <div class="form-group">
                            <label for="paymentAmount">Bayar:</label>
                            <input type="text" id="paymentAmount" class="form-control" oninput="calculateChange()" placeholder="Masukkan jumlah pembayaran">
                        </div>
                        <!-- Input field for Kembali -->
                        <div class="form-group">
                            <label for="changeAmount">Kembali:</label>
                            <input type="text" id="changeAmount" class="form-control" readonly>
                        </div>

                        <!-- Print Button -->
                        <button class="btn btn-print" onclick="printReceipt()">
                            <i class="fas fa-print print-icon" style="color: blue;"></i> Cetak Nota
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Kotak di sebelah kanan -->
        <div class="col-md-6">
            <div id="barangSection">
                <div id="searchContainer" class="mb-2">
                    <label for="searchInput">Cari:</label>
                    <input type="text" id="searchInput" class="form-control" placeholder="Cari berdasarkan abjad...">
                </div>
                <table id="barangTable" class="table table-bordered">
                    <thead>
                        <tr>
                            <th class="hidden">ID</th>
                            <th>Nama</th>
                            <th>Kategori</th>
                            <th>Pcs</th>
                            <th>Isi Pac</th>
                            <th>Isi Dos</th>
                            <th>Kulak</th>
                            <th>Hrg Pcs</th>
                            <th>Hrg Pac</th>
                            <th>Hrg Dos</th>
                            <th>Hrg Member</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

        <!-- Bootstrap JS, DataTables, and dependencies -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
        
        <script>
const webAppUrl = 'https://script.google.com/macros/s/AKfycbxvt3hz83AUwz_KfXYi6DGmnSzGL-_j4hBuGROKbQgtCgEPyCo_82QxMz4IeaaoEHVL/exec'; // Replace with your Google Apps Script URL

let selectedItem = null;
let transactions = [];

// Fungsi untuk mengambil semua barang dari Google Sheets
function getAllBarang() {
    fetch(`${webAppUrl}?action=getAllBarang`)
        .then(response => response.json())
        .then(data => {
            const tbody = document.querySelector('#barangTable tbody');
            tbody.innerHTML = ''; // Bersihkan baris sebelumnya

            data.forEach(row => {
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                // Tambahkan event listener untuk memilih baris saat diklik
                tr.onclick = () => {
                    selectedItem = row;
                    document.getElementById('item').value = selectedItem[1]; // Misalkan nama item ada di kolom ke-2
                    document.getElementById('quantity').value = 1; // Kuantitas default
                    updatePrice(); // Memperbarui harga berdasarkan jenis harga yang dipilih
                
                    // Buka modal
                    $('#itemModal').modal('show');
                };
                tbody.appendChild(tr);
            });

            // Tampilkan tabel dan bagian pencarian yang tersembunyi
            document.getElementById('barangSection').style.display = 'block';

            var table = $('#barangTable').DataTable({
            destroy: true,
            paging: false,
            info: false,
            lengthChange: false,
            searching: false, // Nonaktifkan pencarian bawaan DataTables
            columnDefs: [
                {
                    targets: 0,
                    visible: false
                }
            ]
        });

        $('#searchInput').on('keyup', function() {
    var searchTerm = this.value.toLowerCase(); // Dapatkan input pencarian
    table.rows().every(function() {
        var data = this.data(); // Ambil data dari baris
        var rowString = ''; // Gabungkan teks dari kolom yang akan dicari

        // Gabungkan kolom yang ingin dicari
        for (var i = 1; i < data.length; i++) {
            rowString += data[i].toLowerCase() + ' ';
        }

        // Jika baris cocok dengan pencarian, tampilkan baris, jika tidak, sembunyikan
        if (rowString.indexOf(searchTerm) !== -1) {
            $(this.node()).show(); // Tampilkan baris
        } else {
            $(this.node()).hide(); // Sembunyikan baris
        }
    });
});
        });
    }

function getIsiIndex(priceType, dataRow) {
    switch (priceType) {
        case 'pcs': return dataRow[3];  // Ambil nilai dari kolom 'Isi Pcs'
        case 'pac': return dataRow[4];  // Ambil nilai dari kolom 'Isi Pac'
        case 'dos': return dataRow[5];  // Ambil nilai dari kolom 'Isi Dos'
        case 'mm': return dataRow[3];   // Ambil nilai dari kolom 'Isi MM'
        default: return 0;             // Nilai default jika jenis harga tidak cocok
    }
}

function updatePrice() {
    // Retrieve the selected price type, default to 'MM' if not set or invalid
    const priceType = document.getElementById('priceType').value || 'mm';
    const quantity = parseFloat(document.getElementById('quantity').value) || 1;
    const priceIndex = getPriceIndex(priceType);
    
    // Retrieve the data row, replace with the actual data source
    const dataRow = selectedItem || []; // Ganti dengan baris data yang sesuai
    const price = parseFloat(dataRow[priceIndex]) || 0;
    const isi = getIsiIndex(priceType, dataRow) || 0;
    
    // Update price and isi fields in the form
    document.getElementById('price').value = price;
    document.getElementById('isi').value = isi;

    // Calculate total
    const total = (price * quantity) || 0;
    
    // Update total field in the form
    document.getElementById('total').value = total;
}

// Fungsi untuk mendapatkan indeks kolom harga berdasarkan jenis harga
function getPriceIndex(priceType) {
    switch (priceType) {
        case 'pcs': return 7; // Misalkan harga per pcs ada di kolom ke-8
        case 'pac': return 8; // Misalkan harga per pac ada di kolom ke-9
        case 'dos': return 9; // Misalkan harga per dos ada di kolom ke-10
        case 'mm': return 10; // Misalkan harga per mm ada di kolom ke-11
        default: return 7;
    }
}

function addTransaction() {
    transactionCount++; // Tambah nomor urut setiap kali fungsi dipanggil
    const itemName = document.getElementById('item').value;
    const quantity = parseInt(document.getElementById('quantity').value);
    const priceType = document.getElementById('priceType').value;
    const pricePerUnit = parseFloat(document.getElementById('total').value);
    const total = Math.round(quantity * pricePerUnit); // Membulatkan total ke bilangan bulat

    if (itemName && quantity > 0 && pricePerUnit > 0) {
                // Add transaction data to global array
                transactions.push({
                    itemName: itemName,
                    quantity: quantity,
                    priceType: priceType,
                    pricePerUnit: pricePerUnit,
                    total: total
                });
        const tbody = document.querySelector('#transactionTable tbody');
        // Baris untuk Nomor Urut dan Nama Barang
        let tr = document.createElement('tr');
        tr.classList.add('service');
        tr.classList.add('transaction-header');
        tr.innerHTML = `
            <td class="tableitem">
                <div class="combined-content">
                    <p class="itemtext">${itemName}</p>
                </div>
            </td>
        `;
        tbody.appendChild(tr);

        // Baris untuk Jumlah, Jenis, Harga, dan Total
        tr = document.createElement('tr');
        tr.classList.add('service');
        tr.classList.add('transaction-header');
        tr.innerHTML = `
            <td class="tableitem" colspan="4">
                <div class="combined-content">
                    <p class="itemtext">${quantity} ${priceType}</p>
                </div>
            </td>
            <td class="tableitem hide-column"><p class="itemtext">${pricePerUnit.toFixed(0)}</p></td>                              
            <td class="tableitem"><p class="itemtext">${total.toFixed(0)}</p></td>
            <td><button class="btn-no-bg" onclick="removeRow(this)">
                <i class="fas fa-trash"></i> <!-- Ikon hapus -->
            </button></td>
        `;
        tbody.appendChild(tr);

        updateGrandTotal();
        resetForm();
    } else {
        alert('Silakan lengkapi informasi transaksi.');
    }
}
window.onload = function() {
    transactionCount = 0; // Reset nomor urut saat halaman dimuat
}
function updateGrandTotal() {
    let total = 0;
    
    // Loop through each row in the table and calculate the total
    document.querySelectorAll('#transactionTable tbody tr').forEach(row => {
        const totalCell = row.querySelector('td:nth-child(3)'); // Adjusted to get the correct 'Total' column
        if (totalCell) {
            const value = parseFloat(totalCell.textContent.replace(/[^\d.-]/g, '')); // Remove non-numeric characters
            total += !isNaN(value) ? value : 0;
        }
    });

    // Update the input field with the calculated total, formatted in Indonesian Rupiah format
    document.getElementById('updateGrandTotal').value = `Rp ${total.toLocaleString('id-ID', {maximumFractionDigits: 0})}`;
}
function removeRow(button) {
            // Remove row from table
            const row = button.closest('tr');
            row.parentNode.removeChild(row);

            // Optionally, remove from transactions array as well
            // This would require tracking rows and their data
        }

        // Fungsi untuk menghitung kembali otomatis
document.getElementById('paymentAmount').addEventListener('input', function(e) {
    // Ambil nilai yang diinput, hapus simbol non-angka
    let input = e.target.value.replace(/\D/g, '');

    // Jika input ada isinya, format menjadi mata uang, jika kosong biarkan kosong
    if (input) {
        input = parseInt(input, 10).toLocaleString('id-ID').replace(/,/g, '.'); // Format angka dengan titik
        e.target.value = `Rp ${input}`; // Tambahkan "Rp" di depan
    } else {
        e.target.value = ''; // Kosongkan kolom bayar jika input dihapus
    }

    // Panggil fungsi hitung kembalian
    calculateChange();
});
function calculateChange() {
    // Ambil nilai grand total dan hapus simbol Rp dan tanda ribuan
    const grandTotal = parseFloat(document.getElementById('updateGrandTotal').value.replace('Rp ', '').replace(/\./g, '').replace(/,/g, '.'));

    // Ambil nilai pembayaran (bayar) dan hapus simbol Rp dan tanda ribuan
    const payment = parseFloat(document.getElementById('paymentAmount').value.replace('Rp ', '').replace(/\./g, '').replace(/,/g, '.'));

    // Hitung kembalian
    let change = payment - grandTotal;

    // Tetap tampilkan nilai negatif jika bayar kurang dari total
    if (isNaN(change)) {
        change = 0;  // Jika hasil perhitungan invalid, set ke 0
    }

    // Format hasil kembalian ke format Rupiah
    const formattedChange = `Rp ${Math.floor(change).toLocaleString('id-ID').replace(/,/g, '.')}`;

    // Set nilai kembalian ke input changeAmount
    document.getElementById('changeAmount').value = formattedChange;

    return {
        grandTotal: `Rp ${grandTotal.toLocaleString('id-ID').replace(/,/g, '.')}`,
        paymentAmount: `Rp ${payment.toLocaleString('id-ID').replace(/,/g, '.')}`,
        changeAmount: formattedChange
    };
}

function resetForm() {
                document.getElementById('item').value = '';
                document.getElementById('quantity').value = '';
                document.getElementById('price').value = '';
                document.getElementById('priceType').value = 'mm';
            }
            
        // Call getAllBarang when the document loads
        document.addEventListener('DOMContentLoaded', getAllBarang);
        
        function printReceipt() {
    // Pastikan data transaksi ada
    if (!transactions || transactions.length === 0) {
        alert('Tidak ada transaksi untuk dicetak.');
        return;
    }

    // Generate the table rows based on the stored transaction data
    let rows = '';
    transactions.forEach(data => {
        rows += `
            <tr class="service">
                <td class="tableitem">
                    <div class="combined-content">
                        <p class="itemtext">${data.itemName}</p>
                    </div>
                </td>
            </tr>
            <tr class="service">
                <td class="tableitem" colspan="4">
                    <div class="combined-content">
                        <p class="itemtext">${data.quantity} ${data.priceType}</p>
                    </div>
                </td>
                <td class="tableitem hide-column"><p class="itemtext">${data.pricePerUnit.toFixed(0)}</p></td>
                <td class="tableitem"><p class="itemtext">${data.total.toFixed(0)}</p></td>
            </tr>
        `;
    });

    // Hitung nilai total, bayar, dan kembalian
    const transactionSummary = calculateChange();

    // Open a new window for printing
    const printWindow = window.open('', '_blank');
    printWindow.document.open();

    // Write the HTML for the print page
    printWindow.document.write(`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <title>Receipt</title>
                <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
                <style>
                            /* Add styles for printing */
                    body { font-family: 'Poppins', sans-serif; }
                    .tableitem { /* Your styles here */ }
                    .hide-column { display: none; }
                    .combined-content { /* Your styles here */ }
                    .itemtext { /* Your styles here */ }
                    /* Add more styles as needed */
                    @media print {
                .page-break { display: block; page-break-before: always; }
            }
                #invoice-POS {
            box-shadow: 0 0 1in -0.25in rgba(0, 0, 0, 0.5);
            padding: 2mm;
            margin: 0 auto;
            width: 44mm;
            background: #FFF;
            }
            #invoice-POS ::selection {
            background: #f31544;
            color: #FFF;
            }
            #invoice-POS ::moz-selection {
            background: #f31544;
            color: #FFF;
            }
            #invoice-POS h1 {
            font-size: 1.5em;
            color: #222;
            }
            #invoice-POS h2 {
            font-size: .9em;
            }
            #invoice-POS h3 {
            font-size: 1.2em;
            font-weight: 300;
            line-height: 2em;
            }
            #invoice-POS p {
            font-size: .7em;
            color: #000000;
            line-height: 1.2em;
            text-align: center;
            margin-bottom: 0;
            }
            #invoice-POS #top, #invoice-POS #mid, #invoice-POS #bot {
            /* Targets all id with 'col-' */
            border-bottom: 1px solid #EEE;
            }
            #invoice-POS #top {
            min-height: 100px;
            }
            #invoice-POS #mid {
            min-height: 0px;
            }
            #invoice-POS #bot {
            min-height: 50px;
            margin: 0;
            }
            #invoice-POS #top .logo {
            height: 60px;
            width: 60px;
            background: url(https://github.com/MerpatiQuu/MTsAU/blob/main/WhatsApp%20Image%202024-09-11%20at%2014.38.17.jpeg?raw=true) no-repeat;
            background-size: 60px 60px;
            filter: grayscale(100%);
            }

            #invoice-POS .clientlogo {
            float: left;
            height: 60px;
            width: 60px;
            background: url(https://github.com/MerpatiQuu/MTsAU/blob/main/WhatsApp%20Image%202024-09-11%20at%2014.38.17.jpeg?raw=true) no-repeat;
            background-size: 60px 60px;
            border-radius: 50px;
            filter: grayscale(100%);
            }

            #invoice-POS .info {
            display: block;
            margin-left: 0;
            }
            #invoice-POS .title {
            float: right;
            }
            #invoice-POS .title p {
            text-align: right;
            }
            #invoice-POS table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            }
            #invoice-POS .tabletitle {
            font-size: .5em;
            margin: 0;
            }
            #invoice-POS .service {
            border-bottom: 1px solid #EEE;
            }
            #invoice-POS .item {
            width: 24mm;
            }
            #invoice-POS .itemtext {
            font-size: .5em;
            text-align: left;
            }
            #invoice-POS #legalcopy {
            margin-top: 5mm;
            }
            h2 {margin: 0.2rem;}
            h6 {margin: 0;}
            h5 {margin: 0;
            font-size: x-small;
            font-family: 'Poppins', sans-serif;}
            .hide-column {
                display: none !important;
            }
                    /* Style for centering the buttons */
        .modal-buttons {
            display: flex;
            justify-content: center;  /* Center the buttons horizontally */
            margin-top: 20px;
        }

        /* Style for individual buttons */
        .modal-buttons .print-btn, 
        .modal-buttons button {
            background-color: #4CAF50; /* Green background */
            color: white;  /* White text */
            padding: 10px 20px;  /* Button padding */
            border: none;  /* Remove default border */
            border-radius: 5px;  /* Rounded corners */
            font-size: 16px;  /* Font size */
            margin: 0 10px;  /* Space between buttons */
            cursor: pointer;  /* Pointer cursor */
            transition: background-color 0.3s ease;  /* Transition effect */
        }

        /* Hover effect for buttons */
        .modal-buttons .print-btn:hover {
            background-color: #45a049;  /* Darker green when hovering */
        }

        .modal-buttons button:hover {
            background-color: #f44336;  /* Red when hovering for the close button */
        }

        /* Hide the buttons when printing */
        @media print {
            .modal-buttons {
                display: none;
            }
        /* Control page margins and content alignment */
            body {
                margin: 0;
                padding: 0;
                background-color: white; /* Ensure the background is white */
            }

            .printable-area {
                max-width: 100%;
                page-break-inside: avoid; /* Avoid breaking inside the content */
            }

            /* Optional: Limit paper size if required */
            @page {
                size: auto; /* Automatically adjust to content */
                margin: 10mm; /* Set page margins */
            }

            /* Optional: Prevent empty pages if content is smaller */
            html, body {
                height: auto; /* Adjust the height to the content */
            }
            .itemtext {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            }
        }
    </style>
</head>
<body translate="no">
    <div class="printable-area">
  <div id="invoice-POS">

    <center id="top">
      <div class="logo"></div>
      <div class="info"> 
        <h2>Toko MerpatiQuu</h2>
        <h6>Beddian-Jambesari Ds-Bondowoso</h6>
        <h6>-</h6>
        <h6>082257730020</h6>
      </div><!--End Info-->
    </center><!--End InvoiceTop-->

    <div id="mid">
      <div class="info">
        <h6></h6>
        <p> 
            Detail Belanjaan Anda
        </p>
      </div>
    </div><!--End Invoice Mid-->

        <div id="bot">
            <div id="table">
                <table>
                    ${rows}
                    <tr>
                            <td colspan="5" style="border-top: 2px solid #000; padding: 0;"></td>
                        </tr>
                <tr class="tabletitle">
                    <td></td>
                    <td class="Rate" style="text-align: left;"><h2>Total</h2></td>
                    <td class="total"><h2>${transactionSummary.grandTotal}</h2></td> <!-- Dynamic Total -->
                </tr>
                <tr class="tabletitle">
                    <td></td>
                    <td class="Rate" style="text-align: left;"><h2>Bayar</h2></td>
                    <td class="payment"><h2>${transactionSummary.paymentAmount}</h2></td> <!-- Dynamic Payment -->
                </tr>
                <tr class="tabletitle">
                    <td></td>
                    <td class="Rate" style="text-align: left;"><h2>Kembali</h2></td>
                    <td class="change"><h2>${transactionSummary.changeAmount}</h2></td> <!-- Dynamic Change -->
                </tr>
            </table>                    </div><!--End Table-->
            </div>

            <div id="legalcopy">
                <h5 class="legal" style="text-align: center;"><strong>Harga Selaras Belanja Puas</strong></h5>
                <h6 class="legal" style="text-align: center;"><strong>-</strong></h6>
                <h6 class="legal" style="text-align: center;"><strong>Mator Sekalangkong</strong></h6>
            </div>
        </div>
    </div>
</div>
    <div class="modal-buttons">
        <button class="print-btn" onclick="window.print()">Print</button>
        <button onclick="window.close()">Close</button>
    </div>

</body>
</html>
`);
            printWindow.document.close();
            printWindow.print();
            // Clear the transactions array if needed
            transactions = [];
        }

    </script>

</body>
</html>
